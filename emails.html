<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>메일 목록</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body { background: #fffbe7; }
    .emails-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    .emails-table th, .emails-table td { border: 1px solid #e1c97a; padding: 8px; font-size: 0.95em; }
    .emails-table th { background: #ffe9a7; }
    .emails-table tr:nth-child(even) { background: #fff6d6; }
    .emails-table tr:hover { background: #ffe9a7; }
    .emails-header { font-size: 1.2em; font-weight: bold; margin-top: 10px; }
  </style>
</head>
<body>
  <div class="modal-content">
    <div class="emails-header">저장된 메일 목록</div>
        <div style="margin: 10px 0; display: flex; gap: 10px;">
          <button id="selectAllTodo" style="padding:4px 12px; background:#ffe07a; border:1px solid #e2c97b; border-radius:5px; cursor:pointer;">전체 To-Do 선택</button>
          <button id="deselectAllTodo" style="padding:4px 12px; background:#fffbe7; border:1px solid #e2c97b; border-radius:5px; cursor:pointer;">전체 To-Do 해제</button>
        </div>
    <table class="emails-table" id="emailsTable">
      <thead>
        <tr>
          <th>수신일</th>
          <th>제목</th>
          <th>발신자</th>
          <th>To-Do</th>
        </tr>
      </thead>
      <tbody>
        <!-- JS로 메일 목록 렌더링 -->
      </tbody>
    </table>
  </div>
  <script>
    function renderEmails(emails) {
      const tbody = document.getElementById('emailsTable').querySelector('tbody');
      tbody.innerHTML = '';
      emails.forEach(mail => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${mail.received_at}</td>
          <td>${mail.subject}</td>
          <td>${mail.from_addr}</td>
          <td><input type="checkbox" ${mail.todo_flag ? 'checked' : ''} data-id="${mail.id}" /></td>
        `;
        tr.title = mail.body ? mail.body.substring(0, 200) : '';
        tbody.appendChild(tr);
      });
      // 체크박스 이벤트
      tbody.querySelectorAll('input[type="checkbox"]').forEach(cb => {
        cb.addEventListener('change', async (e) => {
          const id = cb.getAttribute('data-id');
          const flag = cb.checked ? 1 : 0;
          await window.electronAPI.setEmailTodoFlag(id, flag);
          // 최신 목록 다시 렌더링
          const emails = await window.electronAPI.getEmails();
          renderEmails(emails);
        });
      });
      // 전체 선택/해제 버튼 이벤트
      document.getElementById('selectAllTodo').onclick = async () => {
        const ids = emails.filter(m => m.todo_flag !== 1).map(m => m.id);
        for (const id of ids) {
          await window.electronAPI.setEmailTodoFlag(id, 1);
        }
        const updated = await window.electronAPI.getEmails();
        renderEmails(updated);
      };
      document.getElementById('deselectAllTodo').onclick = async () => {
        const ids = emails.filter(m => m.todo_flag !== 0).map(m => m.id);
        for (const id of ids) {
          await window.electronAPI.setEmailTodoFlag(id, 0);
        }
        const updated = await window.electronAPI.getEmails();
        renderEmails(updated);
      };
    }
    window.electronAPI.getEmails().then(renderEmails);
  </script>
</body>
</html>
